# 📋 数学文档处理系统 - 操作指南

## 🚀 启动服务（按顺序执行）

### 1. 启动Python解析服务
```bash
# 在第一个命令行窗口运行
.\start_python.bat
```
**等待看到**: `INFO:     Uvicorn running on http://0.0.0.0:8001`

### 2. 启动Node.js主服务  
```bash
# 在第二个命令行窗口运行
.\start_nodejs.bat
```
**等待看到**: `🚀 Math Document Processor Main Service running on port 3000`

### 3. 验证服务状态
```bash
# 在第三个命令行窗口运行
python upload_demo.py
```

## 📤 上传docx文件的方法

### 方法1：使用Python演示脚本（推荐新手）

1. **准备docx文件**
   - 将包含数学公式的.docx文件复制到项目根目录
   - 文件名可以是中文或英文

2. **运行演示脚本**
   ```bash
   python upload_demo.py
   ```
   
3. **查看结果**
   - 脚本会自动检测服务状态
   - 自动上传找到的第一个.docx文件
   - 显示上传结果和文档ID
   - 自动测试搜索功能

### 方法2：使用测试客户端

```bash
# 上传指定文件
python test_client.py --file your_document.docx

# 搜索文档
python test_client.py --search "数学公式"

# 检查系统状态
python test_client.py --status
```

### 方法3：使用curl命令（适合开发者）

```bash
# 上传文档
curl -X POST -F "docxFile=@your_document.docx" http://localhost:3000/upload

# 搜索文档
curl -X POST -H "Content-Type: application/json" -d "{\"query\":\"数学公式\",\"limit\":5}" http://localhost:3000/search

# 健康检查
curl http://localhost:3000/health
```

### 方法4：使用Postman或类似工具

1. **上传文档**
   - URL: `POST http://localhost:3000/upload`
   - Body: form-data
   - Key: `docxFile` (file类型)
   - Value: 选择你的.docx文件

2. **搜索文档**
   - URL: `POST http://localhost:3000/search`
   - Headers: `Content-Type: application/json`
   - Body: `{"query": "你的搜索词", "limit": 5}`

## 🔍 完整工作流程示例

### 步骤1: 检查服务
```bash
# 检查所有服务是否正常
curl http://localhost:3000/status
```

**期望输出**:
```json
{
  "mainService": "healthy",
  "pythonService": "healthy", 
  "documentStore": "healthy"
}
```

### 步骤2: 上传文档
```bash
# 假设你有一个名为 "数学题目.docx" 的文件
curl -X POST -F "docxFile=@数学题目.docx" http://localhost:3000/upload
```

**期望输出**:
```json
{
  "success": true,
  "message": "File processed and stored successfully",
  "data": {
    "documentId": "uuid-here",
    "filename": "数学题目.docx",
    "contentPreview": "已知函数f(x)=ax²+bx+c...",
    "contentLength": 1250
  }
}
```

### 步骤3: 搜索文档
```bash
curl -X POST -H "Content-Type: application/json" \
  -d '{"query":"二次函数","limit":3}' \
  http://localhost:3000/search
```

**期望输出**:
```json
{
  "success": true,
  "query": "二次函数",
  "results": {
    "documents": ["文档内容1", "文档内容2"],
    "metadatas": [{"filename": "数学题目.docx"}, ...],
    "distances": [0.2, 0.4]
  }
}
```

## 🐛 常见问题排查

### 问题1: 服务无法启动
```bash
# 检查端口是否被占用
netstat -ano | findstr :3000
netstat -ano | findstr :8001

# 如果端口被占用，结束进程
taskkill /PID <进程ID> /F
```

### 问题2: 上传失败
- 确保文件是.docx格式
- 检查文件大小不超过50MB
- 确保Python服务正常运行

### 问题3: 搜索无结果
- 确保已经上传过文档
- 尝试使用文档中实际包含的词语搜索
- 检查搜索词的拼写

## 📊 系统监控

### 查看日志
```bash
# 查看上传目录
dir uploads

# 检查服务状态
python test_client.py --status
```

### 性能测试
```bash
# 批量上传测试
for %f in (*.docx) do python test_client.py --file "%f"

# 搜索性能测试
python test_client.py --search "测试" --limit 10
```

## 🎯 下一步

1. **添加更多文档**: 继续上传不同类型的数学文档
2. **测试搜索**: 尝试不同的搜索关键词
3. **查看API文档**: 访问 http://localhost:8001/docs
4. **扩展功能**: 根据需要修改代码添加新功能

## 📞 获取帮助

如果遇到问题：
1. 查看命令行窗口的错误信息
2. 运行 `python upload_demo.py` 进行诊断
3. 检查 uploads/ 和 logs/ 目录中的文件 